<app-navbar></app-navbar>
<mat-card class="profile-card1">
  <div class="profile-body-container d-flex justify-content-center">
    <div class="profile-card">
      <div
        class="cover-image"
        [ngStyle]="{
          'background-image': userProfile?.backgroundPicture ? 'url(' + userProfile.backgroundPicture + ')' : '/assets/thumb-1920-516890.jpg'
        }"
      ></div>
      <div class="profile-header text-center">
        <img [src]="userProfile?.profilePicture" alt="Profile" class="profile-img" />
        <div class="profile-info">
          <h2>{{userProfile?.firstName}} {{userProfile?.lastName}} <mat-icon class="verified">verified</mat-icon></h2>
          <p>{{userProfile?.email}}</p>
          <div class="details">
            Joined on {{ userProfile?.dateJoined | date: 'dd MMM yyyy' }}
          </div>
        </div>
        <div class="header-actions">
          <button mat-stroked-button color="primary">Edit profile</button>
        </div>
      </div>
<div class="profile-card1">
      <mat-tab-group>
        <mat-tab label="Feed">
          <div class="post-container mat-elevation-z2">
            <mat-form-field appearance="outline" class="full-width">
  <textarea matInput placeholder="Share your thoughts..." cdkTextareaAutosize
    [(ngModel)]="postContent" name="postContent"></textarea>
</mat-form-field>

            <div class="photos-section mt-4" *ngIf="postedPhotos.length > 0">
              <div class="photos-grid">
                <div class="photo-item" *ngFor="let photo of postedPhotos" >
                  <img [src]="photo" class="img-fluid" alt="Posted photo" style="width: 100%; height: 500px;">
                </div>
              </div>
            </div>
    <div class="post-options justify-content-between align-items-center d-flex flex-wrap gap-2">
  <div class="d-flex align-items-center gap-3 flex-wrap">
<button mat-button (click)="fileInput.click()" class="d-flex align-items-center gap-1">
  <mat-icon>image</mat-icon>
  Photo
</button>
<input #fileInput type="file" accept="image/*" (change)="onFileSelected($event)" style="display: none;">


   <mat-form-field appearance="fill" class="category-select">
  <mat-label>{{ selectedCategory ? selectedCategory.categoryName : 'Category' }}</mat-label>
  <mat-select  [(value)]="selectedCategory" (selectionChange)="onCategoryChange($event.value)">
    <mat-option *ngFor="let category of postCategories" [value]="category.categoryId">
      {{ category.categoryName }}
    </mat-option>
  </mat-select>
</mat-form-field>

  </div>

  <button type="button" class="btn btn-primary text-white" (click)="postPhoto()">Post</button>
</div>




          </div>
         <ng-container *ngIf="userPosts && userPosts.length > 0">
  <mat-card class="post-card" *ngFor="let post of userPosts">
     <div class="post-header d-flex justify-content-between align-items-start">
  <div class="d-flex">
    <img [src]="post?.user.profilePicture" alt="User Avatar" class="post-avatar">
    <div class="post-user-info">
      <h3>{{post?.user.firstName}} {{post?.user.lastName}}</h3>
      <div class="post-meta">
        <span class="post-time">{{post.datePosted | timeago }}</span>
      </div>
    </div>
  </div>

  <!-- Three-dot menu -->
  <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="More options">
    <mat-icon>more_vert</mat-icon>
  </button>
  <mat-menu #menu="matMenu" >
    <button mat-menu-item (click)="editPost(post)">
      <mat-icon>edit</mat-icon>
      <span>Edit Post</span>
    </button>
    <button mat-menu-item (click)="deletePost(post.postId)">
      <mat-icon>delete</mat-icon>
      <span>Remove Post</span>
    </button>
  </mat-menu>
</div>

    <div class="post-content">
      <p>{{ post.content }}</p>
       <div class="photo-post" *ngIf="post?.attachments.length>0">
            <img [src]="post?.attachments[0].attachmentPath" 
            class="img-fluid" alt="Posted photo"  style="width: 100%; max-height: 500px; object-fit: cover;">
        </div>
    </div>

 <div class="post-actions">
  <div class="action-buttons action-item">
    <button mat-icon-button (click)="toggleLike(post.postId)">
      <mat-icon color="accent">
        {{ likedPosts[post.postId] ? 'thumb_up' : 'thumb_up_off_alt' }}
      </mat-icon>
    </button>
    <span style="color: rgb(0,0,90); font-weight: 500;">{{ likedPosts[post.postId] ? 'Liked' : 'Like' }} ({{ post?.postLikes.length || 0 }})</span>
  </div>

  <div class="action-buttons action-item">
    <button mat-button (click)="toggleComments(post.postId)">
      <mat-icon>chat_bubble_outline</mat-icon>
      <span>Comments ({{ post.comments?.length || 0 }})</span>
    </button>
  </div>
</div>


    <div *ngIf="commentVisibility[post.postId]">
      <div class="comment-input">
        <mat-form-field appearance="outline" class="full-width">
          <input matInput placeholder="Add a comment...">
            <button mat-icon-button matSuffix color="primary" >
    <mat-icon>send</mat-icon>
  </button>
        </mat-form-field>
      </div>

     <div class="existing-comment" *ngFor="let comment of post.comments">
  <div class="comment-header d-flex justify-between align-center">
  <div class="comment-left d-flex">
    <img [src]="comment?.user.profilePicture" alt="profilePicture" class="comment-avatar">
    <div class="comment-user-info">
      <h4>{{comment?.user.firstName}} {{comment?.user.lastName}}</h4>
      <span class="comment-time">{{comment?.datePosted | timeago }}</span>
    </div>
  </div>

  <button mat-icon-button [matMenuTriggerFor]="commentMenu">
    <mat-icon>more_vert</mat-icon>
  </button>

  <mat-menu #commentMenu="matMenu">
    <button mat-menu-item (click)="editComment(comment)">
      <mat-icon>edit</mat-icon>
      <span>Edit</span>
    </button>
    <button mat-menu-item (click)="deleteComment(comment.id)">
      <mat-icon>delete</mat-icon>
      <span>Delete</span>
    </button>
  </mat-menu>
</div>

  <div class="comment-text">
    <p>{{ comment?.content }}</p>
  </div>

  <div class="comment-footer">
    <button mat-icon-button (click)="toggleCommentLike(comment.id)">
      <mat-icon color="accent">
        {{ likedComments[comment.id] ? 'thumb_up' : 'thumb_up_off_alt' }}
      </mat-icon>
    </button>
    <span>{{ likedComments[comment.id] ? 'Liked' : 'Like' }}</span>
  </div>
</div>
    </div>
  </mat-card>
</ng-container>


        </mat-tab>
        <mat-tab label="About">
            <div class="about-card">
          <h3>About</h3>
            <p>{{userProfile?.brif || 'No bio available' }}</p>
            <p><mat-icon>email</mat-icon> Email: <strong>{{userProfile?.email || 'Not provided' }}</strong></p>
            <p><mat-icon>work</mat-icon> {{userProfile?.job || 'Not specified' }}</p>
            <p><mat-icon>location_on</mat-icon> {{userProfile?.address || 'No location info' }}</p>
            <p><mat-icon>phone</mat-icon> {{ userProfile?.phoneNumber || 'No phone number' }}</p>
          </div>
        
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            Connections 
          </ng-template>
            <div class="media-card ">
            <p>No connections yet.</p>
            </div>
        </mat-tab>
        <mat-tab label="Media">
          <div class="media-card">
          <p>No Media yet.</p>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
  </div>
</mat-card>


